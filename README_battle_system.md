# 五子棋对战系统

## 概述

本项目提供了两个版本的对战系统，支持多种对战模式和AI算法：

- **GUI版本** (`gui_battle_system.py`): 图形化界面对战系统
- **命令行版本** (`simple_battle_system.py`): 简化版对战系统（无GUI依赖）

## 功能特点

### 🎮 对战模式
- **人机对战**: 人类 vs AI
- **AI对战**: 不同AI算法对战
- **人人对战**: 人类 vs 人类

### 🤖 AI类型
- **随机AI**: 随机选择空位
- **RL AI**: 基于强化学习策略的AI
- **扩散AI**: 基于扩散模型的AI

### ⚙️ 游戏设置
- **棋盘大小**: 10x10
- **先后手选择**: 可指定玩家1和玩家2的类型
- **模型选择**: 可加载训练好的模型文件

## 安装要求

### GUI版本
```bash
# 安装PyQt5
pip install PyQt5

# 确保其他依赖已安装
pip install torch numpy tensorboard
```

### 命令行版本
```bash
# 仅需要基本依赖
pip install numpy
```

## 使用方法

### 🎯 GUI版本使用

1. **启动程序**:
```bash
python gui_battle_system.py
```

2. **设置玩家**:
   - 玩家1 (先手 ●): 选择 "人类"、"随机AI"、"RL AI" 或 "扩散AI"
   - 玩家2 (后手 ○): 选择 "人类"、"随机AI"、"RL AI" 或 "扩散AI"

3. **选择模型**:
   - 点击"选择RL模型"按钮加载强化学习模型
   - 点击"选择扩散模型"按钮加载扩散模型
   - 程序会自动查找最佳模型

4. **开始游戏**:
   - 点击"开始新游戏"
   - 如果是人类玩家，点击棋盘上的空位落子
   - AI玩家会自动落子

5. **游戏控制**:
   - **暂停/继续**: 暂停或继续当前游戏
   - **重新开始**: 开始新的游戏
   - **保存游戏**: 保存当前游戏状态（功能待实现）

### 💻 命令行版本使用

1. **启动程序**:
```bash
python simple_battle_system.py
```

2. **选择对战模式**:
```
选择对战模式：
1. 人机对战
2. AI对战
3. 人人对战
请选择模式 (1-3):
```

3. **选择先手**:
```
选择先手 (1 或 2):
```

4. **选择AI类型** (如果选择AI对战):
```
选择AI类型：
1. 随机AI
2. RL AI (强化学习)
3. 扩散AI
请选择AI类型 (1-3):
```

5. **下子方式**:
   - **格式1**: `B5` (字母B表示第2列，5表示第5行)
   - **格式2**: `1,4` (第1行，第4列)

## 模型文件

### 📁 模型位置
程序会自动在以下目录查找模型：
- `./models/*/best_rl_policy.pth` (最佳RL模型)
- `./models/*/best_diff_policy.pth` (最佳扩散模型)

### 🔄 模型格式
- **RL模型**: `RLPolicyNet` 架构的PyTorch模型
- **扩散模型**: `UNetPolicy` 架构的PyTorch模型

### 📊 模型选择
- GUI版本可以通过文件选择器加载特定模型
- 命令行版本会自动查找最新的最佳模型

## 游戏规则

### 🎯 获胜条件
- 任意一方先在横、竖、斜线或反斜线上连续放置5个棋子
- 棋盘填满且无人获胜则为平局

### ⚡ 操作流程
1. 先手玩家 (●) 落子
2. 后手玩家 (○) 落子
3. 交替进行直到游戏结束
4. 显示获胜者和游戏统计

## 界面说明

### 🖼️ GUI界面布局
```
┌─────────────────────────┬──────────────────────────┐
│        棋盘区域        │      控制面板          │
│                        │                        │
│  A B C D E F G H I J  │  游戏设置              │
│  ● ○ · · · · · · · ●  │  玩家1: [下拉框]     │
│  · ● ○ · · · · · ○ ·  │  玩家2: [下拉框]     │
│  · · ● ○ · · ○ · · ·  │                        │
│  · · · ● ○ · · · · ·  │  模型选择              │
│  · · · · ● · · · · ·  │  RL模型: [选择按钮]    │
│  · · · ○ ● ○ · · · ○  │  扩散模型: [选择按钮]  │
│  · · ○ · · ● ○ · · ·  │                        │
│  · ○ · · · · ● ○ · ·  │  游戏控制              │
│  ○ · · · · · · ● ○ ·  │  [开始新游戏]          │
│                        │  [暂停/继续]            │
│                        │                        │
└─────────────────────────┴──────────────────────────┘
```

### 📝 状态信息
- **当前玩家**: 显示该谁下子
- **回合数**: 当前游戏的总回合计数
- **游戏记录**: 显示每一步的详细记录
- **状态栏**: 显示当前游戏状态

## AI算法说明

### 🎲 随机AI
- 随机选择一个空位落子
- 适合测试和娱乐

### 🧠 RL AI
- 基于强化学习训练的策略网络
- 使用卷积神经网络评估局面
- 通过REINFORCE算法训练
- 选择胜率最高的位置

### 🌊 扩散AI
- 基于扩散模型的策略生成
- 使用小型U-Net架构
- 通过去噪过程生成最优落子位置
- 具有更好的创造性

## 故障排除

### ❌ 常见问题

1. **PyQt5未安装**:
```bash
pip install PyQt5
```

2. **模型文件未找到**:
   - 确保已经运行过训练程序
   - 检查 `models/` 目录中是否存在 `.pth` 文件

3. **模型加载失败**:
   - 确保模型文件格式正确
   - 尝试重新选择其他模型文件

4. **点击无响应**:
   - 确保点击的是空位
   - 检查是否轮到人类玩家下子

5. **程序无法启动**:
   - 检查Python版本 (建议3.7+)
   - 确保所有依赖已正确安装

### 🐛 错误信息
- `"PyQt5 未安装"`: 安装PyQt5依赖
- `"模型模块导入失败"`: 检查项目文件完整性
- `"无效移动"`: 点击有效的空位
- `"AI无法找到有效移动"`: 棋盘可能已满或出现异常

## 技术细节

### 🏗️ 系统架构
```
BattleSystem
├── ChessBoardWidget (GUI) / SimpleChessBoard (CLI)
├── GameEngine
├── AIPlayer (基类)
│   ├── RandomAI
│   ├── RLAI
│   └── DiffusionAI
└── ModelLoader
```

### 🔧 核心组件
- **棋盘绘制**: 基于PyQt5的2D图形渲染
- **游戏逻辑**: 完整的五子棋规则实现
- **AI集成**: 无缝集成多种AI算法
- **模型管理**: 自动加载和管理训练好的模型

### 📈 性能特点
- **响应速度**: AI推理时间 < 1秒
- **内存使用**: < 500MB (包含模型加载)
- **支持模型**: 支持 .pth 格式的PyTorch模型

## 更新日志

### v1.0.0 (当前版本)
- ✅ 完整的GUI界面对战系统
- ✅ 支持多种AI类型
- ✅ 自动模型发现和加载
- ✅ 简化版命令行对战系统
- ✅ 完整的游戏规则实现

### 计划功能
- 🔄 游戏保存/加载功能
- 📊 更详细的AI思考过程显示
- 🎨 主题和界面自定义
- 🌐 在线对战支持
- 📈 性能分析和统计

## 许可证

本项目基于原始训练代码开发，遵循相应的开源许可证。

## 贡献

欢迎提交Issue和Pull Request来改进对战系统！

---

**享受您的五子棋对战体验！** 🎮